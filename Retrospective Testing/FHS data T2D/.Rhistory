)
BMI_lastexam_no
BMI_lastexam_no[1:10]
z<-matrix(sample(c(T.F), 9),3,3)
z<-matrix(sample(c(T,F), 9),3,3)
z<-matrix(sample(c(T,F), 9, replace=T),3,3)
z
(1:3)[z]
(1:3)[t(z)]
z<-matrix(sample(c(T,F), 12, replace=T),4,3)
z
BMI_lastexam_no <- apply(BMI_isna, 1 , function(x) max(which(x)))
BMI_lastexam_no[1:10]
data_offage$las
BMI_lastexam = rep(0,nrow(BMI0_27exams))#
for(i in 1:dim(BMI0_27exams)[1]) {#
	BMI_lastexam[i] = BMI0_27exams[i,BMI_lastexam_no[i]]#
}
BMI_lastexam[1:10]
BMI_lastexam  <- sapply(1:nrow(BMI0_27exams), function(i) BMI0_27exams[i, BMI_lastexam_no[i]])
BMI_lastexam[1:10]
BMI_ave = rowMeans(BMI0_27exams)
summary(BMI_ave)
BMI_ave = rowMeans(BMI0_27exams, na.rm=T)
summary(BMI_ave)
dim(pheno0)
pheno0[1:6,]
pheno0 = as.data.frame(cbind(pheno0,BMI_lastexam, BMI_lastexam_no,#
BMI_ave, 0))
dim(pheno0)
colnames(pheno0)=c("pedno","shareid","pheno","sex","lastexam_age",#
"lastexam_no","BMI_lastexam","BMI_lastexam_no","BMI_ave","cohortid")
pheno0[1:6,]#
dim(pheno0)
####Work on cohort 1#
list_c1 = list(#
#
E1 = rbind(c("A50","weight_ex1","in pounds"),#
		c("A51","height_inch_ex1","in full inches"),#
		c("A52","height_excess_ex1","in hundredths of inch")#
),#
#
E2 = rbind(c("B15","weight_ex2","in pounds"),#
		c("B16","height_inch_ex2","in full inches"),#
		c("B17","height_excess_ex2","in hundredths of inch")#
),#
#
E3 = rbind(c("C416","weight_ex3","in pounds"),#
		c("C417","height_ex3","to lower quarter inch")#
),#
#
E4 = rbind(c("D401","weight_ex4","in pounds"),#
		c("D402","height_ex4","to lower quarter inch")#
),#
#
E5 = rbind(c("E024","weight_ex5","in pounds"),#
		c("E025","height_ex5","to lower quarter inch")#
),#
#
E6 = rbind(c("F007","weight_ex6","in pounds"),#
		c("F008","height_ex6","to lower quarter inch")#
),#
#
E7 = rbind(c("G440","weight_ex7","in pounds"),#
		c("G441","height_ex7","to lower quarter inch")#
)#
)
dim(pheno0)
list_c1 = list(#
#
E1 = rbind(c("A50","weight_ex1","in pounds"),#
c("A51","height_inch_ex1","in full inches"),#
c("A52","height_excess_ex1","in hundredths of inch")#
),#
#
E2 = rbind(c("B15","weight_ex2","in pounds"),#
c("B16","height_inch_ex2","in full inches"),#
c("B17","height_excess_ex2","in hundredths of inch")#
),#
#
E3 = rbind(c("C416","weight_ex3","in pounds"),#
c("C417","height_ex3","to lower quarter inch")#
),#
#
E4 = rbind(c("D401","weight_ex4","in pounds"),#
c("D402","height_ex4","to lower quarter inch")#
),#
#
E5 = rbind(c("E024","weight_ex5","in pounds"),#
c("E025","height_ex5","to lower quarter inch")#
),#
#
E6 = rbind(c("F007","weight_ex6","in pounds"),#
c("F008","height_ex6","to lower quarter inch")#
),#
#
E7 = rbind(c("G440","weight_ex7","in pounds"),#
c("G441","height_ex7","to lower quarter inch")#
)#
)
cov1 = cbind(shareid = shareid1)#
tot_indiv = nrow(cov1)#
for (f in 1:7) {#
	file_name = paste("../work_Sheng/clinic_exams/C1_E",f,".txt", sep='')#
	data_cov = read.table(file=file_name, sep="\t",fill=TRUE,header=TRUE)#
	cov_names = list_c1[[f]][,1]#
	cov_names_semantic = list_c1[[f]][,2]#
	len_cov_names = length(cov_names)#
	ind_order_in_data <- match(shareid1, data_cov$shareid)#
	#
	cov_current <- t(sapply(1:tot_indiv, function(i){#
							if (!is.na(ind_order_in_data[i])) {#
							unlist(data_cov[ind_order_in_data[i],cov_names])#
							} else rep(NA, len_cov_names)#
							}))#
	colnames(cov_current) = cov_names_semantic#
	cov1 = cbind(cov1, cov_current)#
	print(paste("Exam",f,"is done!"))#
}#
# Matrix with ID and covariate information#
cov1 = as.data.frame(cov1)
height_ex1 = cov1$height_inch_ex1+cov1$height_excess_ex1/100#
height_ex2 = cov1$height_inch_ex2+cov1$height_excess_ex2/100#
height_ex3 = cov1$height_ex3#
height_ex4 = cov1$height_ex4#
height_ex5 = cov1$height_ex5#
height_ex6 = cov1$height_ex6#
height_ex7 = cov1$height_ex7#
height = cbind(height_ex1,height_ex2, height_ex3, height_ex4, height_ex5,#
height_ex6,height_ex7)
ls()
rm(genodata22)
rm(SNPname22)
dim(cov1)
head(cov1)
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1_sheng)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
diff3big_set=shareid0_sheng[which(apply(flag_bad,1,sum)>=1)]#
print(c(thr3,length(diff3big_set)))
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
diff3big_set=shareid1[which(apply(flag_bad,1,sum)>=1)]#
print(c(thr3,length(diff3big_set)))
thr3=2#
# determine rows with extreme values for height#
diff3big_set=shareid1[apply(height,1, function(x) sum(diff(sort(x)) > thr3)) > 0]#
print(c(thr3,length(diff3big_set)))
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
diff3big_set=shareid1[which(apply(flag_bad,1,sum)>=1)]#
print(c(thr3,length(diff3big_set)))
diff3big_set
sort(diff3big_set)
thr3=2#
# determine rows with extreme values for height#
diff3big_set=shareid1[apply(height,1, function(x) sum(diff(sort(x)) > thr3)) > 0]#
print(c(thr3,length(diff3big_set)))
sort(diff3big_set)
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
which(apply(flag_bad,1,sum)>=1)
thr3=2#
# determine rows with extreme values for height#
apply(height,1, function(x) sum(diff(sort(x)) > thr3)) > 0
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
which(apply(flag_bad,1,sum)>=1)
thr3=2#
# determine rows with extreme values for height#
which(apply(height,1, function(x) sum(diff(sort(x)) > thr3)) > 0)
sort(height[371,])
sum(diff(sort(height[371,])))
(diff(sort(height[371,])))
is.na(diff(sort(height[371,])))
length(diff(sort(height[371,])))
diff3big_set=shareid1[apply(height,1, function(x){ sx <- diff(sort(x)); sum(sx > thr3)>0 | length(sx) == 0})]
which(apply(height,1, function(x){ sx <- diff(sort(x)); sum(sx > thr3)>0 | length(sx) == 0}))
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
which(apply(flag_bad,1,sum)>=1)
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
diff3big_set=shareid1[which(apply(flag_bad,1,sum)>=1)]#
print(c(thr3,length(diff3big_set)))
thr3=2#
# determine rows with extreme values for height#
diff3big_set=shareid1[apply(height,1, function(x){ sx <- diff(sort(x)); sum(sx > thr3)>0 | length(sx) == 0})]#
print(c(thr3,length(diff3big_set)))
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
(diff3big_set=shareid1[which(apply(flag_bad,1,sum)>=1)])
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
sort(diff3big_set=shareid1[which(apply(flag_bad,1,sum)>=1)])
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
sort(diff3big_set<-shareid1[which(apply(flag_bad,1,sum)>=1)])
thr3=2#
# determine rows with extreme values for height#
sort(diff3big_set<-shareid1[apply(height,1, function(x){ sx <- diff(sort(x)); sum(sx > thr3)>0 | length(sx) == 0})])
height[sharedid1==671,]
height[shareid1==671,]
diff(sort(height[shareid1==671,]))
diff(sort(height[shareid1==1163,]))
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
which(apply(flag_bad,1,sum)>=1)])
thr3=2#
flag_bad = matrix(1, dim(height)[1],dim(height)[2])#
for(i in 1:length(shareid1)) {#
	for (j in 1:7) {#
		if (!is.na(height[i,j])){#
		for (k in 1:7) {#
			if (!is.na(height[i,k]) && k != j){#
			if (abs(height[i,j]-height[i,k])<=thr3) {#
				flag_bad[i,j]=0#
		 		break		 		#
		 	}#
		 	#
		 	}			#
		}#
		} else {flag_bad[i,j]=0}			#
	}#
}#
which(apply(flag_bad,1,sum)>=1)
height[19,]
height[26,]
manual_good = c(26, 45, 60, 67, 371, 436, 454, 459, 551, 552,#
                570, 571, 574, 699, 717, 750, 817, 849, 854, 856,#
                863, 866, 918, 971, 972,1003, 1226, 1388, 1393, 1516,#
                1625, 1642, 1650, 1829, 1930, 1996, 2002, 2047, 2090, 2092,#
                2136, 2137, 2144, 2226, 2264, 2392, 2417, 2628, 2682, 2703,#
                2741, 2827, 2840, 2955, 2970, 3033, 3158, 3174, 3193, 3204, #
                3216, 3250, 3252, 3254, 3256, 3259, 3304,3347,3405)
height1_correct = height#
height1_correct = data.frame(height1_correct)#
for (i in 1:dim(flag_bad)[1]) {#
	for (j in 1:dim(flag_bad)[2]) {#
		if (flag_bad[i,j]==1 && !is.element(i,manual_good)) height1_correct[i,j]=NA#
	}#
#
}
height1_correct[which(apply(flag_bad,1,sum)>=1)#
,]
head(height1_correct[which(apply(flag_bad,1,sum)>=1)#
,],7)
x<-height1_correct[which(apply(flag_bad,1,sum)>=1)#
,]
height1_correct = as.data.frame(t(sapply(1:nrow(height), function(i){#
	sapply(1:ncol(height), function(j){#
		   if (!any(abs(height[i,-j]-height[i,j])<=thr3, na.rm=T) & !is.element(i,manual_good)) NA else height[i,j]#
		   })#
})))#
colnames(height0_correct) <- colnames(height)
height1_correct = as.data.frame(t(sapply(1:nrow(height), function(i){#
	sapply(1:ncol(height), function(j){#
		   if (!any(abs(height[i,-j]-height[i,j])<=thr3, na.rm=T) & !is.element(i,manual_good)) NA else height[i,j]#
		   })#
})))#
colnames(height1_correct) <- colnames(height)
head(height1_correct[which(apply(flag_bad,1,sum)>=1)#
,],7)
all.equal(x, height1_correct)
str(x)
str(height1_correct)
height1_correct = as.data.frame(t(sapply(1:nrow(height), function(i){#
	sapply(1:ncol(height), function(j){#
		   if (!any(abs(height[i,-j]-height[i,j])<=thr3, na.rm=T) & !is.element(i,manual_good)) NA else height[i,j]#
		   })#
})))#
colnames(height1_correct) <- colnames(height)
str(height1_correct)
nrow(height)
length(height_ex1)
height1_correct = height#
height1_correct = data.frame(height1_correct)#
for (i in 1:dim(flag_bad)[1]) {#
	for (j in 1:dim(flag_bad)[2]) {#
		if (flag_bad[i,j]==1 && !is.element(i,manual_good)) height1_correct[i,j]=NA#
	}#
#
}
dim(flag_bad)
all.equal(x, height1_correct)
all.equal(x, height1_correct[which(apply(flag_bad,1,sum)>=1),])
cov1 = as.data.frame(cov1)#
# Make phenotype+covariate matrix#
ind_all <- match(shareid1, data_shareid_all$shareid)#
ind_off <- match(shareid1,  data_offage$shareid)#
pheno1 <- cbind(data_shareid_all$pedno[ind_all], pheno1, data_shareid_all$SEX[ind_all], data_offage$max_age[ind_off], apply(data_offgage[ind_off,4:10]-data_offage$max_age[ind_off], 1, function(x) which(x == 0)))
cov1 = as.data.frame(cov1)#
# Make phenotype+covariate matrix#
ind_all <- match(shareid1, data_shareid_all$shareid)#
ind_off <- match(shareid1,  data_offage$shareid)#
pheno1 <- cbind(data_shareid_all$pedno[ind_all], pheno1, data_shareid_all$SEX[ind_all], data_offage$max_age[ind_off], apply(data_offage[ind_off,4:10]-data_offage$max_age[ind_off], 1, function(x) which(x == 0)))
head(pheno)
head(pheno1)
#### weight informaton#
weight1_correct = as.matrix(cov1[,grepl("weight",colnames(cov1))])#
# construct bmi#
BMI1_7exams = weight1_correct/height1_correct/height1_correct*703.07#
BMI_isna = !is.na(BMI1_7exams)#
BMI_lastexam_no <- apply(BMI_isna, 1 , function(x) max(which(x)))#
#
# Get last BMI value on file as well as average BMI for all individuals#
BMI_lastexam  <- sapply(1:nrow(BMI1_7exams), function(i) BMI1_7exams[i, BMI_lastexam_no[i]])#
BMI_ave = rowMeans(BMI1_7exams, na.rm=T)#
# Add BMI variables to data frame#
pheno1 = as.data.frame(cbind(pheno1,BMI_lastexam, BMI_lastexam_no,#
BMI_ave, 1)) #
colnames(pheno0)=c("pedno","shareid","pheno","sex","lastexam_age",#
"lastexam_no","BMI_lastexam","BMI_lastexam_no","BMI_ave","cohortid")
#
pheno1[1:6,]#
dim(pheno1)
colnames(pheno1)=c("pedno","shareid","pheno","sex","lastexam_age",#
"lastexam_no","BMI_lastexam","BMI_lastexam_no","BMI_ave","cohortid")
#
pheno1[1:6,]#
dim(pheno1)
#
pheno0[1:6,]#
dim(pheno1)
cov3 = cbind(shareid = shareid3)#
tot_indiv = nrow(cov3)#
#
data_cov = read.csv("../work_Sheng/clinic_exams/C3_E1.csv",fill=TRUE,header=TRUE)#
cov_names = names(data_cov3)#
len_cov_names = length(cov_names)#
ind_order_in_data <- match(shareid3, data_cov$shareid)
cov_names = names(data_cov)#
len_cov_names = length(cov_names)#
ind_order_in_data <- match(shareid3, data_cov$shareid)
tot_indiv
cov_names
ind_order_in_data <- match(shareid3, data_cov$shareid)#
weight3 = data_cov3[ind_order_in_data, "G3A444"]#
height3 = data_cov3[ind_order_in_data, "G3A446"]#
bmi3 = data_cov3[ind_order_in_data, "G3A707"]
weight3 = data_cov[ind_order_in_data, "G3A444"]#
height3 = data_cov[ind_order_in_data, "G3A446"]#
bmi3 = data_cov[ind_order_in_data, "G3A707"]
bmi3
sum(is.na(bmi3))
BMI3 = weight3/height3/height3*703.07#
which(is.na(bmi3)); which(is.na(weight3))#
which(is.na(BMI3))
max(abs(BMI3-bmi3),na.rm=TRUE)
which(is.na(bmi3))#
which(is.na(BMI3))
head(cbind(bmi3,BMI3))
head(height3,weight3)
head(cbind(height3,weight3))
head(cbind(bmi3,weight3/height3/height3*703.1))
head(cbind(bmi3,weight3/height3/height3*703))
head(cbind(bmi3,round(weight3/height3/height3,1)*703.1))
head(cbind(bmi3,round(weight3/height3/height3,2)*703.1))
head(cbind(bmi3,round(weight3/height3/height3,3)*703.1))
head(cbind(bmi3,round(weight3/height3/height3,4)*703.1))
head(cbind(bmi3,round(weight3/height3/height3,5)*703.1))
height4<-round(height3,2)
head(cbind(bmi3,weight3/height4/height4*703))
height4<-round(height3,3)
head(cbind(bmi3,weight3/height4/height4*703))
height4<-round(height3,1)
head(cbind(bmi3,weight3/height4/height4*703))
head(cbind(bmi3,weight3/height4/height4*703))
height4<-round(height3,0)
head(cbind(bmi3,weight3/height4/height4*703))
data_cov3<-data_cov
names_data_cov3 = names(data_cov3)#
weight_colid = which(names_data_cov3=="G3A444")#
height_colid = which(names_data_cov3=="G3A446")#
bmi_colid = which(names_data_cov3=="G3A707")#
weight3 = rep(0,length(shareid3_sheng))#
height3 = rep(0,length(shareid3_sheng))#
bmi3 = rep(0,length(shareid3_sheng))#
for(i in 1:length(shareid3_sheng)) {#
	weight3[i] = data_cov3[which(data_cov3$shareid==shareid3_sheng[i]),weight_colid]#
	height3[i] = data_cov3[which(data_cov3$shareid==shareid3_sheng[i]),height_colid]#
	bmi3[i] = data_cov3[which(data_cov3$shareid==shareid3_sheng[i]),bmi_colid]#
}#
####four individuals have missing height and weight#
BMI3 = weight3/height3/height3*703.07#
which(is.na(bmi3))#
which(is.na(BMI3))#
max(abs(BMI3-bmi3),na.rm=TRUE)
names_data_cov3 = names(data_cov3)#
weight_colid = which(names_data_cov3=="G3A444")#
height_colid = which(names_data_cov3=="G3A446")#
bmi_colid = which(names_data_cov3=="G3A707")#
weight3 = rep(0,length(shareid3))#
height3 = rep(0,length(shareid3))#
bmi3 = rep(0,length(shareid3))#
for(i in 1:length(shareid3)) {#
	weight3[i] = data_cov3[which(data_cov3$shareid==shareid3[i]),weight_colid]#
	height3[i] = data_cov3[which(data_cov3$shareid==shareid3[i]),height_colid]#
	bmi3[i] = data_cov3[which(data_cov3$shareid==shareid3[i]),bmi_colid]#
}#
####four individuals have missing height and weight#
BMI3 = weight3/height3/height3*703.07#
which(is.na(bmi3))#
which(is.na(BMI3))#
max(abs(BMI3-bmi3),na.rm=TRUE)
ind_all <- match(shareid3, data_shareid_all$shareid)#
ind_off <- match(shareid3,  data_gen3pheno$shareid)#
pheno3 <- cbind(data_shareid_all$pedno[ind_all], pheno3, data_shareid_all$SEX[ind_all], data_gen3pheno$age_exam[ind_off], 1)
head(pheno3)
ind_all <- match(shareid3, data_shareid_all$shareid)#
ind_off <- match(shareid3,  data_gen3pheno$shareid)#
pheno3 <- cbind(data_shareid_all$pedno[ind_all], pheno3, data_shareid_all$SEX[ind_all], data_gen3pheno$age_exam[ind_off], 1)#
# Add BMI variables to data frame#
pheno3 = as.data.frame(cbind(pheno3,BMI3, 1, BMI3,3))#
colnames(pheno3)=c("pedno","shareid","pheno","sex","lastexam_age",#
"lastexam_no","BMI_lastexam","BMI_lastexam_no","BMI_ave","cohortid")
head(pheno3)
head(pheno3,12)
head(pheno3)
pheno3 =  pheno3_analysis[pheno3_analysis$pheno !=-4,]
head(pheno3)
ind_all <- match(shareid3, data_shareid_all$shareid)#
ind_off <- match(shareid3,  data_gen3pheno$shareid)#
pheno3 <- cbind(data_shareid_all$pedno[ind_all], pheno3, data_shareid_all$SEX[ind_all], data_gen3pheno$age_exam[ind_off], 1)#
# Add BMI variables to data frame#
pheno3 = as.data.frame(cbind(pheno3,BMI3, 1, BMI3,3))#
colnames(pheno3)=c("pedno","shareid","pheno","sex","lastexam_age",#
"lastexam_no","BMI_lastexam","BMI_lastexam_no","BMI_ave","cohortid")
head(pheno3)
dim(pheno3)
dim(pheno2)
dim(pheno1)
dim(pheno0)
table(data_shareid_all$ID)
919+3746+3415
pheno3_sheng[1:6,]#
dim(pheno3_sheng)
pheno3[1:6,]#
dim(pheno3)
pheno = rbind(pheno0,pheno1,pheno3)
head(pheno)
head(pheno,50)
pheno$pedno[is.na(pheno$pedno)]
pheno$pedno[is.na(pheno$pedno),]
pheno[is.na(pheno$pedno),]
x<-pheno[is.na(pheno$pedno),]
pheno$pedno[is.na(pheno$pedno)] <- 0
pheno[is.na(pheno$pedno),]
pheno[4300:4334,]
tail(pheno)
dim(pheno)
write.table(pheno_sheng,"phenocov.txt",sep="\t", row.names=FALSE,#
col.names=TRUE)
write.table(pheno,"phenocov.txt",sep="\t", row.names=FALSE,#
col.names=TRUE)
head(pheno)
head(pheno[order(pheno$pedno),])
head(pheno[order(pheno$pedno),],100)
head(pheno[order(pheno$pedno),],200)
head(pheno[order(pheno$pedno),],200)
pheno[order(pheno$pedno)[300:400],]
pheno[order(pheno$pedno)[400:450],]
summary(pheno$ped)
tail(pheno,10)
pheno[pheno$shareid == 19005]
pheno[pheno$shareid == 18005,]
pheno[pheno$shareid == 66,]
pheno[pheno$shareid == 3,]
pheno[pheno$shareid == 16687,]
length(unique(ped))
length(unique(pheno$ped))
unaff <- sum(pheno$pedno == 0)#
ord <- order(pheno$pedno)#
pheno1 <- rbind(pheno[ord[-(1:unaff)]],pheno[ord[1:unaff]])
unaff <- sum(pheno$pedno == 0)#
ord <- order(pheno$pedno)#
pheno1 <- rbind(pheno[ord[-(1:unaff)],],pheno[ord[1:unaff],])
head(pheno)
head(pheno1)
unique(pheno$ped)
dim(pheno)
dim(pheno1)
pheno <- rbind(pheno[ord[-(1:unaff)],],pheno[ord[1:unaff],]) #
unique_fam <- unique(pheno$ped)[-1]
unique(fam)
unique(pheno$ped)
head(pheno)
n_person_fam <- table(pheno$pedno)
n_person_fam
unaff
n_person_fam <- table(pheno$pedno)[-1]
n_person_fam
unique(pheno$ped)
unique_fam <- sort(unique(pheno$ped))[-1]#
# number of peope in each pedigree#
n_person_fam <- table(pheno$pedno)[-1]
x<-c(rep(1:length(unique_fam), each = n_person_fam), length(unique_fam) + 1:nunaff)
x<-c(rep(1:length(unique_fam), each = n_person_fam), length(unique_fam) + 1:unaff)
length(x)
n_person_
n_person_fam
sum()n_person_fam)
sum(n_person_fam)
length(n_person_fam)
length(unique_fam)
unique_fam <- sort(unique(pheno$ped))[-1]#
# number of peope in each pedigree#
n_person_fam <- table(pheno$pedno)[-1]
str(rep(1:length(unique_fam), each = n_person_fam))
rep(1:length(unique_fam), each = n_person_fam)
head(n_person_fam)
n_person_fam <- table(pheno$pedno)
head(n_person_fam)
head(n_person_fam[-1])
n_person_fam
n_person_fam[-1]
1:length(unique_fam)
head(rep(1:length(unique_fam), each = n_person_fam))
n_person_fam <- table(pheno$pedno)[-1]
x<-c(rep(1:length(unique_fam), each = n_person_fam), length(unique_fam) + 1:unaff)
head(cbind(pheno$pedno, x), 20)
x<-c(rep(1:length(unique_fam), n_person_fam), length(unique_fam) + 1:unaff)
length(x)
head(cbind(pheno$pedno, x), 20)
head(cbind(pheno$pedno, x), 200)
pheno$unipedno <- c(rep(1:length(unique_fam), n_person_fam), length(unique_fam) + 1:unaff)
tail(pheno,30)
n_person_fam <- table(pheno$pedno)#
unaff <- n_person_fam[1]#
n_person_fam <- n_person_fam[-1]
unaff
n_person_fam
ord <- order(pheno$pedno)#
pheno <- rbind(pheno[ord[-(1:unaff)],],pheno[ord[1:unaff],]) #
unique_fam <- sort(unique(pheno$ped))[-1]
dim(pheno)
head(pheno)
pheno <- read.table("phenocov.txt", header = T)#
covs <- c('sex', 'BMI_ave')#
# re-arrange phenofile so pedno = {1 to n_fam}#
# number of peope in each pedigree#
n_person_fam <- table(pheno$pedno)#
unaff <- n_person_fam[1]#
n_person_fam <- n_person_fam[-1]#
ord <- order(pheno$pedno)#
pheno <- rbind(pheno[ord[-(1:unaff)],],pheno[ord[1:unaff],]) #
unique_fam <- sort(unique(pheno$ped))[-1]
head(pheno)
pheno$unipedno <- c(rep(1:length(unique_fam), n_person_fam), length(unique_fam) + 1:unaff)
head(pheno)
head(pheno,10)
tail(pheno,10)
x=read.table("../work_sheng/genodata_new/ShareID_allchr.txt",header=FALSE)
str(x)
drop(x)
str(drop(x))
##### Get genotypes#
shareid_retained = pheno$shareid#
shareid_geno = as.vector(read.table("../work_sheng/genodata_new/ShareID_allchr.txt",header=FALSE)$V1)
ind_retained = match(shareid_retained,shareid_geno)
str(ind_retained)
is.na(retained)
sum(is.na(ind_retained))
ind_retained = as.numeric(is.element(shareid_geno,shareid_retained))#
length(ind_retained)#
sum(ind_retained)
